"use strict";(function(){function $(q){return document.querySelector(q);}async function jget(u){const r=await fetch(u,{cache:"no-store"});if(!r.ok)throw new Error("GET "+u);return r.json();}function setOptions(sel,list,selected){sel.innerHTML="";for(let i=0;i<list.length;i++){const v=String(list[i]??"");const o=document.createElement("option");o.value=v;o.textContent=v;sel.appendChild(o);}sel.value=selected||"";}function ensureSelectExists(){let sel=$("#specialty");if(sel)return sel;const field=document.createElement("div");field.className="field";field.id="specialty-field";const lbl=document.createElement("label");lbl.setAttribute("for","specialty");lbl.textContent="Specialty";sel=document.createElement("select");sel.id="specialty";sel.name="specialty";const count=document.createElement("div");count.id="specCount";count.className="muted";field.appendChild(lbl);field.appendChild(sel);field.appendChild(count);const form=document.querySelector("form");if(form&&form.firstElementChild){form.insertBefore(field,form.firstElementChild.nextSibling);}else{document.body.appendChild(field);}return sel;}async function loadSpecialties(){const sel=ensureSelectExists();try{const j=await jget("/api/specialties");const list=Array.isArray(j.specialties)?j.specialties.slice().sort((a,b)=>String(a).localeCompare(String(b))):["General Practice"];const def=(localStorage.getItem("specialty")||list[0]||"General Practice");setOptions(sel,list,def);const c=$("#specCount");if(c)c.textContent=list.length+" specialties loaded (alphabetical)";}catch(_){setOptions(sel,["General Practice"],"General Practice");const c2=$("#specCount");if(c2)c2.textContent="1 specialty loaded";}sel.addEventListener("change",function(){try{localStorage.setItem("specialty",sel.value||"");}catch(_){}});window.getSpecialty=function(){return(sel&&sel.value)||"";};}function boot(){loadSpecialties();}if(document.readyState==="loading"){document.addEventListener("DOMContentLoaded",boot,{once:true});}else{boot();}})();